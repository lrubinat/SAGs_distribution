---
title: "SAGs_distribution"
date: "6.12.2016"
output:  
  html_document:
    theme: united
    toc: yes
  pdf_document:
    highlight: zenburn
    toc: yes
---

<!--- INITIALIZATION
```{r, echo=FALSE}
#error hook to kill knitr in case of errors
library(knitr)
knit_hooks$set(error = function(x, options) stop(x))
opts_chunk$set(cache=TRUE, autodep=TRUE)
```
--->


# 1) Abundance overview

```{r libraries, echo=F, message=F}
library(vegan)
library(data.table)
```


1) Occurrence table
2) Correlation matrix
3) PCA - eigenvalues examination


```{r samples_selection, cache.lazy=F, echo=F}
#global occurrence of swarms in Tara Oceans, BioMarKs and Tara Arctic.
swarms_tb<-fread("/home/lrubinat/Documents/2Q16/data/TARA_V9/globaldataset.otu.v20160830")
head(swarms_tb)

#selection of Tara samples.
tara_sples<-fread("sple.csv")
tara_sples<-tara_sples[fraction%in%c("0.8-5")&depth%in%c("SUR","DCM")&template=="DNA"]

#extract swarms that occur in the selected samples
swarms_abund<-swarms_tb[,.SD,.SDcols=c("md5sum",tara_sples$sample)]
swarms_abund<-melt(swarms_abund,id.vars="md5sum")
swarms_abund<-swarms_abund[value>0]
write.table(swarms_abund, "data_abund_table.txt", sep="\t",row.names=T)

setkey(swarms_abund,variable)
setkey(tara_sples,sample)
swarms_abund<-tara_sples[swarms_abund]

write.table(swarms_abund, "data_abund_table.txt", sep="\t", row.names=T)
#data_abund<-fread("data_abund_table.txt")

#otutb of all swarms occurring in one of the samples 
swarms_otutb <- dcast(swarms_abund, md5sum ~ sample)
swarms_otutb[is.na(swarms_otutb)] <- 0
swarms_otutb[1:5,1:5]
dim(swarms_otutb)

#otutables of SAGs in surface samples
sags_vs_swarms_SRF<-fread("sags_vs_swarms_piconano_SRF.txt")
colnames(sags_vs_swarms_SRF)<-c("no.","id_classif","md5sum","ident.%","SAG_lth","swm_lth","coverage","abund","rank","taxogroup","algae_group","status")
sags_vs_swarms_SRF[1:5,]
dim(sags_vs_swarms_SRF)

sags_otutb_SRF<-merge(swarms_otutb,sags_vs_swarms_SRF, by="md5sum")
sags_otutb_SRF[1:5,]
dim(sags_otutb_SRF)

#otutables of SAGs in DCM samples
sags_vs_swarms_DCM<-fread("sags_vs_swarms_piconano_DCM.txt")
colnames(sags_vs_swarms_DCM)<-c("no.","id_classif","md5sum","ident.%","SAG_lth","swm_lth","coverage","abund","rank","taxogroup","algae_group","status")
dim(sags_vs_swarms_DCM)

sags_otutb_DCM<-merge(swarms_otutb,sags_vs_swarms_DCM, by="md5sum")
sags_otutb_DCM[1:5,]
dim(sags_otutb_DCM)
```




```{r beta_div1, echo=FALSE}
#?vegdist
tb18_tax_occur_ss8522_no_cero.bray<-vegdist(tb18_tax_occur_ss8522_no_cero, method="bray")
boxplot(tb18_tax_occur_ss8522_no_cero.bray, main="Bray-Curtis dissimilarity matrix")


#NMDS
tb18_tax_occur_ss8522_no_cero.nmds<-monoMDS(tb18_tax_occur_ss8522_no_cero.bray)
tb18_tax_occur_ss8522_no_cero.nmds
plot(tb18_tax_occur_ss8522_no_cero.nmds, main="monoMDs method")
```


